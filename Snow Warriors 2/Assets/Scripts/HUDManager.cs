using System.Collections;
using UnityEngine;
using UnityEngine.UI;
using TMPro;
using Cinemachine;
using System.Linq;
using UnityEditor;

using Random = UnityEngine.Random;


public class HUDManager : MonoBehaviour
{
    public static int Cameraindex;
    private bool actionisupdate;

        
    //Class for AI config and setup.
    [System.Serializable]
   

    public class AITile
    {
        //Configurable Attributes
        [Header("Attributes")]
        public string name;
        public Color color;
        
        
        //UI Elements
        [Header("UI Elements")]
        public Graphic icon;
        public TMP_Text nameText;
        public Button buttonSwitchView;
        public TMP_Text infoText;
        public TMP_Text snowballcount;
        public Slider healthbar;
        public Slider staminabar;
        
        //Player Class
        [Header("Player")]
        public Player playerclass;
        
    }
    
    //Cinemachine Cameras
    [Header("Cinemachine")]
    public CinemachineVirtualCamera overviewCamera;
    public CinemachineVirtualCamera playerOneCamera;
    public CinemachineVirtualCamera playerTwoCamera;
    public CinemachineVirtualCamera playerThreeCamera;
    public CinemachineVirtualCamera playerFourCamera;
    public CinemachineVirtualCamera playerFiveCamera;
    public CinemachineVirtualCamera actionCamera;

    //Player Focus Index
    private int playerfocus;
    
    //Main camera button.
    public Button mainCameraButton;
    public Button actionCameraButton;
    
    //Array of AI tiles.
    [Header("Player Setup")]
    public AITile[] AIPlayers;
    
    
    private void Start()
    {
        //Switch to overview camera
        UISwitchCamera(-1);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
        //Update UI to reflect inspector config / add listeners for button presses.
        mainCameraButton.onClick.AddListener(delegate { UISwitchCamera(-1); });
        
        //Update UI to reflect inspector config / add listeners for button presses.
        actionCameraButton.onClick.AddListener(ToggleUpdate);
        
        for (var i = 0; i < AIPlayers.Length; i++)
        {
            var currentindex = i;
            AIPlayers[i].buttonSwitchView.onClick.AddListener(delegate { UISwitchCamera(currentindex);});
            AIPlayers[i].nameText.text = AIPlayers[i].name;
            AIPlayers[i].icon.color = AIPlayers[i].color;
        }
        
    }
    
    private void SwitchCamera()
    {
        if (actionisupdate)
        {
            actionCamera.Priority = 1;
            overviewCamera.Priority = 0;
            playerOneCamera.Priority = 0;
            playerTwoCamera.Priority = 0;
            playerThreeCamera.Priority = 0;
            playerFourCamera.Priority = 0;
            playerFiveCamera.Priority = 0;
        }
      
        var enemyCount = new int[5];
        
        for (var i = 0; i < AIPlayers.Length; i++)
        {
            enemyCount[i] = AIPlayers[i].playerclass.enemiesInHearingRange.Count;
            //Debug.Log("Count: " + enemyCount[i]);
        }

        var highestvalue = enemyCount[0];

        for (var i = 0; i < AIPlayers.Length; i++)
        {
            if (highestvalue == 0)
            {
                playerfocus = Random.Range(0, AIPlayers.Length);

            }
            
            else if (highestvalue < enemyCount[i])
            {
                highestvalue = enemyCount[i];
                playerfocus = ArrayUtility.IndexOf(enemyCount, highestvalue);
            }
        }

   

        if (actionisupdate)
        {
            actionCamera.m_LookAt = AIPlayers[playerfocus].playerclass.gameObject.transform;
        }
       
        
    }

    private void Update()
    {
        foreach (var t in AIPlayers)
        {
            t.healthbar.value = t.playerclass.playerHealth;
            t.staminabar.value = t.playerclass.playerStamina;
            t.snowballcount.text = t.playerclass.playerSmallSnowballCount.ToString();
            t.infoText.text = t.playerclass.debugoutput;
        }
    }
    
    private IEnumerator UpdateCam()
    {
        for (;;)
        {
            SwitchCamera();
                yield return new WaitForSeconds(2f);
                
        }
    }

    void ToggleUpdate()
    {
        actionisupdate = true;
        StartCoroutine(UpdateCam());
    }
    //Switching camera function.
    public void UISwitchCamera(int x)
    {
        actionisupdate = false;

        switch (x)
    {
            case -1:
                overviewCamera.Priority = 1;
                playerOneCamera.Priority = 0;
                playerTwoCamera.Priority = 0;
                playerThreeCamera.Priority = 0;
                playerFourCamera.Priority = 0;
                playerFiveCamera.Priority = 0;
                actionCamera.Priority = 0;
                break;

            case 0:
                overviewCamera.Priority = 0;
                playerOneCamera.Priority = 1;
                playerTwoCamera.Priority = 0;
                playerThreeCamera.Priority = 0;
                playerFourCamera.Priority = 0;
                playerFiveCamera.Priority = 0;
                actionCamera.Priority = 0;
                break;

            case 1:
                overviewCamera.Priority = 0;
                playerOneCamera.Priority = 0;
                playerTwoCamera.Priority = 1;
                playerThreeCamera.Priority = 0;
                playerFourCamera.Priority = 0;
                playerFiveCamera.Priority = 0;
                actionCamera.Priority = 0;
                break;

            case 2:
                overviewCamera.Priority = 0;
                playerOneCamera.Priority = 0;
                playerTwoCamera.Priority = 0;
                playerThreeCamera.Priority = 1;
                playerFourCamera.Priority = 0;
                playerFiveCamera.Priority = 0;
                actionCamera.Priority = 0;
                break;

            case 3:
                overviewCamera.Priority = 0;
                playerOneCamera.Priority = 0;
                playerTwoCamera.Priority = 0;
                playerThreeCamera.Priority = 0;
                playerFourCamera.Priority = 1;
                playerFiveCamera.Priority = 0;
                actionCamera.Priority = 0;
                break;

            case 4:
                overviewCamera.Priority = 0;
                playerOneCamera.Priority = 0;
                playerTwoCamera.Priority = 0;
                playerThreeCamera.Priority = 0;
                playerFourCamera.Priority = 0;
                playerFiveCamera.Priority = 1;
                actionCamera.Priority = 0;
                break;
        }


    }   

}

//Programmed by Johnny Broderick (401460) as part of the 'SnowWarriors' AI development project.